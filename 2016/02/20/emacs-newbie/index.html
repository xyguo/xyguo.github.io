<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Emacs配置文件——新手攻略 | Coupon Collector</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="从以前的博客搬来的老文，描述了自己刚开始用Emacs的时候模仿别人做的配置文件">
<meta property="og:type" content="article">
<meta property="og:title" content="Emacs配置文件——新手攻略">
<meta property="og:url" content="http://yoursite.com/2016/02/20/emacs-newbie/index.html">
<meta property="og:site_name" content="Coupon Collector">
<meta property="og:description" content="从以前的博客搬来的老文，描述了自己刚开始用Emacs的时候模仿别人做的配置文件">
<meta property="og:updated_time" content="2016-06-20T07:24:54.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Emacs配置文件——新手攻略">
<meta name="twitter:description" content="从以前的博客搬来的老文，描述了自己刚开始用Emacs的时候模仿别人做的配置文件">
  
    <link rel="alternate" href="/atom.xml" title="Coupon Collector" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Coupon Collector</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">miscellaneous notes</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
          <a class="main-nav-link" href="/links">Links</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-emacs-newbie" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/20/emacs-newbie/" class="article-date">
  <time datetime="2016-02-20T02:29:22.000Z" itemprop="datePublished">2016-02-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Emacs配置文件——新手攻略
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>用Emacs好一段时间了，由于自己一向懒得折腾，以前用的配置文件直接就是从<a href="https://github.com/purcell/emacs.d" target="_blank" rel="external">Steve Purcell那里</a>fork过来的。但是由于Steve Purcell主要做前端，所以配置文件里各种针对HTML、JavaScript、Ruby之类的插件（虽然绝大部分都被我注释掉了），还有万恶的flymake等我完全用不上的东西。身为一个强迫症患者，这样存在大量冗余的配置文件我实在是忍无可忍了，最近又刚好有时间，遂决心自己从头配过一个简单点的版本：</p>
<ol>
<li>必须保留Purcell的配置里我用的顺手的东西，包括广大群众喜闻乐见的<a href="https://github.com/auto-complete/auto-complete" target="_blank" rel="external">auto-complete</a>，<a href="https://github.com/capitaomorte/yasnippet" target="_blank" rel="external">yasnippet</a>，以及极大提升生活质量的<a href="https://github.com/DarwinAwardWinner/ido-ubiquitous" target="_blank" rel="external">ido-ubiquitous</a>和<a href="https://github.com/nonsequitur/smex" target="_blank" rel="external">smex</a>。</li>
<li>就整个结构来说，Purcell的配置可以称得上是清晰明了，尽管整个配置体积比较庞大，但不会让人晕头转向，各初始化文件的功能划分的很明确，耦合的地方少，文件的命名也很讲究，基本一看就知道是在干啥。<strong>作为新手，Purcell的配置文件是最好不过的模仿对象了</strong>。</li>
<li>根据我个人的需求，需要插件提供对C/C++、Matlab/Mathematica、Python、R、LaTeX/Markdown的增强支持。</li>
</ol>
<p>本人的系统环境如下：</p>
<ul>
<li>Debian sid，x86_64，内核版本3.14</li>
<li>GNU Emacs 24.3.1</li>
<li>clang 3.2-11</li>
</ul>
<h2 id="整个配置文件目录的结构"><a href="#整个配置文件目录的结构" class="headerlink" title="整个配置文件目录的结构"></a>整个配置文件目录的结构</h2><p>首先，Emacs的初始化文件可以有<a href="http://www.emacswiki.org/emacs/InitFile" target="_blank" rel="external">两种设置方法</a>：</p>
<ol>
<li>使用单个文件：<code>~/.emacs</code>。这种方法把所有初始化函数放在一个文件里，设置起来简单，但是一旦插件多了这个文件就会变得很长很乱。</li>
<li>使用目录：<code>~/.emacs.d/</code>。所有配置文件都放在该目录下，并且Emacs启动时会自动执行该目录下名为<code>init.el</code>的文件。虽说只有一个文件会被自动执行，但可以在<code>init.el</code>里执行其它的函数，所以<code>init.el</code>可以变得很简洁；使用Emacs的<a href="http://www.emacswiki.org/emacs/RequiredFeature" target="_blank" rel="external">Feature</a>机制，可以很方便地把具体的初始化工作按类别分在其余文件中。<strong>这也是我选择的方法</strong></li>
</ol>
<p>我自己的配置放在<a href="https://github.com/xyguo/emacs.d" target="_blank" rel="external">这里</a>，目录结构如下（注意其中<code>elpa/</code>目录没有被push到github上）：</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~/.emacs.d/</span><br><span class="line">       README.md  <span class="meta">#请无视该文件</span></span><br><span class="line">       init.el    <span class="meta">#Emacs会自动从init.el开始执行</span></span><br><span class="line">       snippets/  <span class="meta">#yasnippet的自定义模板保存的位置，不重要</span></span><br><span class="line">       elpa/      <span class="meta">#通过ELPA下载的插件所保存的位置</span></span><br><span class="line">       lisp/      <span class="meta">#就是加载各个插件的初始化文件的位置啦</span></span><br><span class="line">           init-xxx.el       <span class="meta">#某初始化文件</span></span><br><span class="line">           editing-utils/    <span class="meta">#文本编辑用的一些小工具</span></span><br><span class="line">           <span class="keyword">custom</span>-themes/    <span class="meta">#自定义的主题，不重要</span></span><br><span class="line">           <span class="keyword">custom</span>-dicts/     <span class="meta">#自定义的auto-complete词典，不重要</span></span><br></pre></td></tr></table></figure>
<h2 id="init-el"><a href="#init-el" class="headerlink" title="init.el"></a>init.el</h2><p>主要就是下面几句</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">;; init.el</span><br><span class="line"></span><br><span class="line">;; 把目录lisp/添加到搜索路径中去</span><br><span class="line">(add-to-list</span><br><span class="line">    'load-path </span><br><span class="line">    (expand-file-name "lisp" user-emacs-directory))</span><br><span class="line"></span><br><span class="line">;; 下面每一个被require的feature都对应一个lisp/目录下的同名</span><br><span class="line">;; elisp文件，例如init-utils.el、init-elpa.el</span><br><span class="line">(require 'init-utils)   ;; 为加载初始化文件提供一些自定义的函数和宏</span><br><span class="line">(require 'init-elpa)    ;; 加载ELPA，并定义了require-package函数</span><br><span class="line">(require 'init-fonts)   ;; 以Server-Client模式启动时需额外设置字体</span><br><span class="line">(require 'init-editing-utils)  ;; 一些顺手的小工具</span><br><span class="line"> ...</span><br><span class="line">(require 'init-markdown)</span><br><span class="line">(require 'init-auctex)</span><br><span class="line"></span><br><span class="line">(provide 'init)</span><br></pre></td></tr></table></figure>
<h2 id="init-utils-el"><a href="#init-utils-el" class="headerlink" title="init-utils.el"></a>init-utils.el</h2><p>最主要的作用是提供了一个宏<code>after-load</code>，供后续的各初始化函数使用。这个函数来自<a href="https://github.com/purcell/emacs.d/blob/master/lisp/init-utils.el" target="_blank" rel="external">Purcell</a>，目的是把一些相互依赖的feature的加载顺序理顺，例如feature A依赖于feature B，则可以写成<code>(after-load &#39;B &#39;A)</code>，这样如果错误地在B之前require了A也不会影响正常启动。</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">;; after-load</span></span><br><span class="line">(<span class="name">defmacro</span> after-load (<span class="name">feature</span> <span class="symbol">&amp;rest</span> body)</span><br><span class="line">  <span class="string">"After FEATURE is loaded, evaluate BODY."</span></span><br><span class="line">  (<span class="name">declare</span> (<span class="name">indent</span> defun))</span><br><span class="line">  `(eval-after-load ,feature</span><br><span class="line">     '(progn ,@body)))</span><br></pre></td></tr></table></figure>
<h2 id="init-elpa-el"><a href="#init-elpa-el" class="headerlink" title="init-elpa.el"></a>init-elpa.el</h2><p>这个文件我也是从<a href="https://github.com/purcell/emacs.d/blob/master/lisp/init-elpa.el" target="_blank" rel="external">Purcell</a>那里截取过来的，但是去掉了很多用不上的函数。该文件主要工作是初始化Emacs的包管理系统<a href="http://www.emacswiki.org/emacs/ELPA" target="_blank" rel="external">ELPA</a>，你可以把ELPA类比为Emacs的软件源，就像Debian、Ubuntu之类的软件源一样。需要注意的是，<strong>仅从Emacs24开始默认支持ELPA</strong>，如果Emacs版本过低，建议升级一下；但如果使用的是Emacs23，也可以从<a href="https://github.com/technomancy/package.el" target="_blank" rel="external">这里</a>下载<code>package.el</code>放在<code>lisp/</code>目录下，然后在<code>init-elpa.el</code>中加入如下代码:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(require 'package)</span><br><span class="line">(add-to-list 'package-archives </span><br><span class="line">    '("marmalade" .</span><br><span class="line">      "http://marmalade-repo.org/packages/"))</span><br><span class="line">  ....</span><br><span class="line">;;这一句放在(provide 'init-elpa)之前</span><br><span class="line">(package-initialize)</span><br></pre></td></tr></table></figure>
<p><code>init-elpa</code>的关键内容如下：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">;; init-elpa.el</span></span><br><span class="line"></span><br><span class="line">(<span class="name">require</span> 'package)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;; 增加软件包仓库</span></span><br><span class="line">(<span class="name">add-to-list</span> 'package-archives '(<span class="string">"org"</span> . <span class="string">"http://orgmode.org/elpa/"</span>))</span><br><span class="line"></span><br><span class="line">(<span class="name">when</span> (<span class="name">&lt;</span> emacs-major-version <span class="number">24</span>)</span><br><span class="line">  (<span class="name">add-to-list</span> 'package-archives '(<span class="string">"gnu"</span> . <span class="string">"http://elpa.gnu.org/packages/"</span>)))</span><br><span class="line"></span><br><span class="line">(<span class="name">add-to-list</span> 'package-archives '(<span class="string">"melpa"</span> . <span class="string">"http://melpa.milkbox.net/packages/"</span>))</span><br><span class="line">(<span class="name">add-to-list</span> 'package-archives '(<span class="string">"melpa-stable"</span> . <span class="string">"http://melpa-stable.milkbox.net/packages/"</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">;; 定义require-package函数</span></span><br><span class="line">(<span class="name">defun</span> require-package (<span class="name">package</span> <span class="symbol">&amp;optional</span> min-version no-refresh)</span><br><span class="line">  <span class="string">"Install given PACKAGE, optionally requiring MIN-VERSION.</span><br><span class="line">If NO-REFRESH is non-nil, the available package lists will not be</span><br><span class="line">re-downloaded in order to locate PACKAGE."</span></span><br><span class="line">  (<span class="name">if</span> (<span class="name">package-installed-p</span> package min-version)</span><br><span class="line">      <span class="literal">t</span></span><br><span class="line">    (<span class="name">if</span> (<span class="name">or</span> (<span class="name">assoc</span> package package-archive-contents) no-refresh)</span><br><span class="line">        (<span class="name">package-install</span> package)</span><br><span class="line">      (<span class="name">progn</span></span><br><span class="line">        (<span class="name">package-refresh-contents</span>)</span><br><span class="line">        (<span class="name">require-package</span> package min-version <span class="literal">t</span>)))))</span><br><span class="line"></span><br><span class="line"><span class="comment">;; 强行提前初始化ELPA。因为默认情况下Emacs在init.el加载完之后才开始初始化ELPA，</span></span><br><span class="line"><span class="comment">;; 而我们把大多数包的初始化函数都放在init.el中，如果不提前初始化ELPA会导致后面的</span></span><br><span class="line"><span class="comment">;; 初始化过程出错（对应的包文件还没有加载进来）。</span></span><br><span class="line">(<span class="name">package-initialize</span>)</span><br><span class="line">(<span class="name">provide</span> 'init-elpa)</span><br></pre></td></tr></table></figure>
<p><code>require-package</code>函数的作用是，判断某个包是否已经安装，如果没有则自动从ELPA中安装它（需要联网）。当然，对于自定义的插件或是没有被ELPA收录的插件，这个函数就不起作用了。</p>
<p>有了ELPA，给Emacs装插件就变的非常容易了。比方说你需要一个叫<code>example</code>的插件，那么可以在<code>lisp/</code>目录下增加一个文件<code>init-example.el</code>：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">;; init-example.el</span></span><br><span class="line"></span><br><span class="line">(<span class="name">require-package</span> 'example)</span><br><span class="line"></span><br><span class="line"><span class="comment">;; ELPA中的插件一般都提供一个"autoloads"方法，可以帮用户自动加载插件并做相应</span></span><br><span class="line"><span class="comment">;; 的配置。不过如果涉及到细节的配置，那请自己看该插件的帮助文档。</span></span><br><span class="line">(<span class="name">require</span> 'example-autoloads)</span><br><span class="line">(<span class="name">provide</span> 'init-example)</span><br></pre></td></tr></table></figure>
<p>然后在<code>init.el</code>中加入一句<code>(require &#39;init-example)</code>(注意这一句要放在<code>(require &#39;init-elpa)</code>之后)即可。</p>
<h2 id="init-auto-complete-el"><a href="#init-auto-complete-el" class="headerlink" title="init-auto-complete.el"></a>init-auto-complete.el</h2><p><a href="https://github.com/auto-complete/auto-complete" target="_blank" rel="external">auto-complete</a>是必不可少的Emacs插件之一，它的问题主要集中在设置触发补全动作的快捷键及添加<code>ac-sources</code>上。默认情况下补全动作是自动触发的，但是如果用了clang之类的扩展，第一次触发可能需要比较久的时间（在构造ac-source），于是给人一种卡出翔的错觉。所以需要将补全动作改为手动触发。<code>ac-sources</code>是<code>auto-complete</code>在补全时自动搜索的模板空间，被补全的半单词会自动在<code>ac-sources</code>里面进行匹配。根据所编辑文件类型的不同，<code>ac-sources</code>最好也不同（例如我在补全C语言关键字的时候<code>auto-complete</code>就不应该去匹配Python的关键字），因此常见的做法是给每个主模式的hook上挂一个函数，由该函数来执行修改<code>ac-sources</code>的工作（具体可见<a href="">init-ac-source.el</a>中的函数<code>ac-latex-mode-setup</code>)。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">;; init-auto-complete.el</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">(require 'auto-complete-config)</span><br><span class="line">(global-auto-complete-mode t)</span><br><span class="line"></span><br><span class="line">;; 把自定义的dict加到auto-complete的字典中去</span><br><span class="line">(add-to-list 'ac-dictionary-directories</span><br><span class="line">             (expand-file-name "lisp/custom-dicts" user-emacs-directory))</span><br><span class="line"></span><br><span class="line">;; 按下TAB时首先缩进所在行，然后尝试补全</span><br><span class="line">(setq tab-always-indent 'complete)</span><br><span class="line"></span><br><span class="line">;; 阻止自动触发补全动作</span><br><span class="line">(setq-default ac-expand-on-auto-complete nil)</span><br><span class="line">(setq-default ac-auto-start nil)</span><br><span class="line">;; 用TAB作为手动触发补全动作的快捷键</span><br><span class="line">(ac-set-trigger-key "TAB")</span><br><span class="line"></span><br><span class="line">;; 使用after-load来确保ac-source-yasnippet已经完成加载</span><br><span class="line">(after-load 'init-yasnippet</span><br><span class="line">  (set-default 'ac-sources</span><br><span class="line">             '(ac-source-dictionary</span><br><span class="line">               ac-source-words-in-buffer</span><br><span class="line">               ac-source-words-in-same-mode-buffers</span><br><span class="line">               ac-source-words-in-all-buffer</span><br><span class="line">               ac-source-functions</span><br><span class="line">               ac-source-yasnippet)))</span><br><span class="line"></span><br><span class="line">(require 'init-ac-source)</span><br><span class="line">(provide 'init-auto-complete)</span><br></pre></td></tr></table></figure>
<h2 id="init-yasnippet-el"><a href="#init-yasnippet-el" class="headerlink" title="init-yasnippet.el"></a>init-yasnippet.el</h2><p><a href="https://github.com/capitaomorte/yasnippet" target="_blank" rel="external">yasnippet</a>是<code>auto-complete</code>的最好搭配。它的触发快捷键包括TAB，这和之前设置的<code>auto-complete</code>的键位冲突，所以做如下配置：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name">require-package</span> 'yasnippet)</span><br><span class="line">(<span class="name">require</span> 'yasnippet)</span><br><span class="line"><span class="comment">;; 使用Ctrl-c k作为唯一的触发快捷键</span></span><br><span class="line">(<span class="name">define-key</span> yas-minor-mode-map (<span class="name">kbd</span> <span class="string">"&lt;tab&gt;"</span>) <span class="literal">nil</span>)</span><br><span class="line">(<span class="name">define-key</span> yas-minor-mode-map (<span class="name">kbd</span> <span class="string">"TAB"</span>) <span class="literal">nil</span>)</span><br><span class="line">(<span class="name">define-key</span> yas-minor-mode-map (<span class="name">kbd</span> <span class="string">"C-c k"</span>) 'yas-expand)</span><br><span class="line"></span><br><span class="line">(<span class="name">yas-global-mode</span> <span class="literal">t</span>)</span><br><span class="line"></span><br><span class="line">(<span class="name">provide</span> 'init-yasnippet)</span><br></pre></td></tr></table></figure>
<h2 id="init-ac-source-el-clang"><a href="#init-ac-source-el-clang" class="headerlink" title="init-ac-source.el : clang"></a>init-ac-source.el : clang</h2><p><a href="http://clang.llvm.org/" target="_blank" rel="external">clang</a>是一个C/C++、Obj-C/Obj-C++的编译器前端，利用它可以<code>auto-complete</code>能够补全C/C++的各种标准库函数。首先需要有<a href="https://github.com/brianjcj/auto-complete-clang" target="_blank" rel="external">auto-complete-clang</a>，然后把系统中各头文件的路径告诉它：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">(<span class="name">require-package</span> 'auto-complete-clang)</span><br><span class="line">(<span class="name">require</span> 'auto-complete-clang)</span><br><span class="line">(<span class="name">setq</span> ac-clang-flags</span><br><span class="line">      (<span class="name">mapcar</span> (<span class="name">lambda</span> (<span class="name">item</span>) (<span class="name">concat</span> <span class="string">"-I"</span> item))</span><br><span class="line">              (<span class="name">split-string</span></span><br><span class="line">               <span class="string">"</span><br><span class="line"> /usr/include/c++/4.8</span><br><span class="line"> /usr/include/x86_64-linux-gnu/c++/4.8</span><br><span class="line"> /usr/include/c++/4.8/backward</span><br><span class="line"> /usr/lib/gcc/x86_64-linux-gnu/4.8/include</span><br><span class="line"> /usr/local/include</span><br><span class="line"> /usr/lib/gcc/x86_64-linux-gnu/4.8/include-fixed</span><br><span class="line"> /usr/include/x86_64-linux-gnu</span><br><span class="line"> /usr/include</span><br><span class="line">"</span></span><br><span class="line">               )))</span><br></pre></td></tr></table></figure>
<p>上述路径可以通过命令<code>echo &quot;&quot; | g++ -v -x c++ -E -</code>来得到（详细说明见<a href="https://github.com/brianjcj/auto-complete-clang" target="_blank" rel="external">这里</a>)。</p>
<h2 id="使用Server-Client的方法来“加速”Emacs的启动"><a href="#使用Server-Client的方法来“加速”Emacs的启动" class="headerlink" title="使用Server-Client的方法来“加速”Emacs的启动"></a>使用Server-Client的方法来“加速”Emacs的启动</h2><p>插件多了Emacs的启动速度就会很慢，为了掩盖（没错，就是掩盖，不是解决…）这个问题，可以用Server-Client的方法营造一种启动很快的错觉，用开机速度换Emacs的启动速度。</p>
<p>具体原理是，开机的时候以daemon模式启动emacs（这时就会进行插件的加载，并执行初始化文件），让它作为server运行在后台，之后再打开Emacs的时候就以client的形式调用，此时它会直接连接到在后台运行的server上，然后server给你一个窗口编辑文件。由于初始化过程已经在启动server时完成了，启动client的时候几乎是秒开。</p>
<p>需要注意的问题是，GTK版本的Emacs以daemon模式启动时，由于一个<a href="https://bugzilla.gnome.org/show_bug.cgi?id=85715" target="_blank" rel="external">Gtk+的Bug</a>，emacsclient可能会时不时地崩溃。解决这个问题的办法是换用<strong>emacs24-lucid</strong>（可以从Debian的源里安装）绕过它。</p>
<p>具体为，开机的时候启动加载下述脚本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/sh</span></span><br><span class="line">LC_CTYPE=zh_CN.utf8 emacs24-lucid --daemon</span><br></pre></td></tr></table></figure>
<p>然后给<code>emacs</code>命令加条alias：<code>emacsclient -a &quot;&quot; -c</code>即可。另外，根据<a href="http://emacser.com/daemon.htm" target="_blank" rel="external">这篇文章</a>，由于启动server的时候是以daemon模式启动的，初始化文件中所有与X有关的设置都失效了。<em>这是因为这些设置是在X下的frame创建时才有效的，而启动服务器的时候是没有创建frame的</em>。在我的机子上，就表现为使用client创建frame后字体奇丑无比，因此使用下述函数来设置字体：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">;; init-fonts.el</span></span><br><span class="line"></span><br><span class="line">(<span class="name">setq</span> window-system-default-frame-alist</span><br><span class="line">      '((x (font . <span class="string">"文泉驿等宽微米黑 11"</span>)) ;; 若frame在X下创建</span><br><span class="line">        (<span class="literal">nil</span>))) <span class="comment">;; 若frame在terminal中创建</span></span><br><span class="line"></span><br><span class="line">(<span class="name">provide</span> 'init-fonts)</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文只是介绍了我认为的配置过程中几个比较重要的文件。全部配置文件可以在<a href="https://github.com/xyguo/emacs.d" target="_blank" rel="external">我的github repository</a>中查看。如果你懒得配置，可以直接clone或fork它。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/02/20/emacs-newbie/" data-id="cipnq4nl6001e3j4kjh9akl1l" class="article-share-link">Share</a>
      
        <a href="http://yoursite.com/2016/02/20/emacs-newbie/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Emacs/">Emacs</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/02/20/compile-linux-0.11/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          64位Debian Sid下编译Linux 0.11内核
        
      </div>
    </a>
  
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Math/">Math</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/">programming</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Emacs/">Emacs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux-Kernel/">Linux Kernel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/distributed-system/">distributed-system</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/programming/">programming</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/puzzle/">puzzle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Emacs/" style="font-size: 10px;">Emacs</a> <a href="/tags/Linux-Kernel/" style="font-size: 20px;">Linux Kernel</a> <a href="/tags/distributed-system/" style="font-size: 10px;">distributed-system</a> <a href="/tags/math/" style="font-size: 10px;">math</a> <a href="/tags/programming/" style="font-size: 10px;">programming</a> <a href="/tags/puzzle/" style="font-size: 10px;">puzzle</a> <a href="/tags/python/" style="font-size: 20px;">python</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/03/26/mit-distributed-system-course-summary/">Summary for MIT 6.824- Course projects</a>
          </li>
        
          <li>
            <a href="/2016/03/21/Python-generators-coroutines-and-asyncio-library-2/">Python coroutines and asyncio library (2)</a>
          </li>
        
          <li>
            <a href="/2016/03/20/Python-generators-coroutines-and-asyncio-library-1/">Python coroutines and asyncio library (1)</a>
          </li>
        
          <li>
            <a href="/2016/02/22/A-Superhard-Elementary-Math-Problem/">A Superhard Elementary Math Problem</a>
          </li>
        
          <li>
            <a href="/2016/02/20/numpy-with-cython/">Numpy with Cython</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 xyguo<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
    <a href="/links" class="mobile-nav-link">Links</a>
  
</nav>
    
<script>
  var disqus_shortname = 'xyguo';
  
  var disqus_url = 'http://yoursite.com/2016/02/20/emacs-newbie/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>




  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>